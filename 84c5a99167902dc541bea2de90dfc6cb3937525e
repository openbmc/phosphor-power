{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "75f1637a_3afdc5b9",
        "filename": "phosphor-power-supply/psu_manager.cpp",
        "patchSetId": 6
      },
      "lineNbr": 364,
      "author": {
        "id": 1000331
      },
      "writtenOn": "2022-03-24T16:18:11Z",
      "side": 1,
      "message": "What happens if the brownout starts while the chassis is powered on and then continues?\n\n* Chassis on\n* Brownout detected\n* Chassis powers down\n* Chassis is now off, so brownout property is cleared by the code above (but it is still happening)\n\nDoes chassis state manager notice the interface states the brownout is over and do an auto-power-restart?\n\nI think PSUManager::analyze() runs when the chassis is powered off, but the brownout stuff is within an \"if (powerOn)\" branch.  So it won\u0027t set the property back to brownout status I think.  Even if it did, would there be a race condition there?\n\nSorry, I might be in the weeds here.  Just trying to understand.",
      "revId": "84c5a99167902dc541bea2de90dfc6cb3937525e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b0799fe3_8d7f690d",
        "filename": "phosphor-power-supply/psu_manager.cpp",
        "patchSetId": 6
      },
      "lineNbr": 364,
      "author": {
        "id": 1000318
      },
      "writtenOn": "2022-03-24T16:34:23Z",
      "side": 1,
      "message": "Right, we are doing surveillance on the psu\u0027s when the chassis is off as well, so we\u0027d want to clear the brownout status when AC comes back, not just because we went through a power off transition (if I\u0027m understanding the concern).",
      "parentUuid": "75f1637a_3afdc5b9",
      "revId": "84c5a99167902dc541bea2de90dfc6cb3937525e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "223ce409_729fb9de",
        "filename": "phosphor-power-supply/psu_manager.cpp",
        "patchSetId": 6
      },
      "lineNbr": 364,
      "author": {
        "id": 1000331
      },
      "writtenOn": "2022-03-24T16:42:26Z",
      "side": 1,
      "message": "Yes, I wasn\u0027t sure why we\u0027d unconditionally clear the brownout property when the chassis power changes to off.\n\nAlso, I think the analyze() function runs when chassis power is off.  However, it looks like (I think) the code that sets or clears the brownout property is within a branch that only runs if chassis power is on.\n\nI realize it is probably tricky, in that while the chassis is off maybe there are some errors we don\u0027t want to log.  Maybe they are replacing PSUs and certain conditions that are bad when the chassis is powered on are OK when it is powered off.\n\nHowever, I\u0027d think (?) we\u0027d want to maintain the brownout property.  Otherwise how does chassis state manager know when a brownout stops or starts while the chassis is off.\n\nSorry if I am just not up to speed on the design.  I haven\u0027t followed this as closely as others.",
      "parentUuid": "b0799fe3_8d7f690d",
      "revId": "84c5a99167902dc541bea2de90dfc6cb3937525e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e78d171a_2b08d6b1",
        "filename": "phosphor-power-supply/psu_manager.cpp",
        "patchSetId": 6
      },
      "lineNbr": 364,
      "author": {
        "id": 1000318
      },
      "writtenOn": "2022-03-24T18:15:40Z",
      "side": 1,
      "message": "You are correct.  We don\u0027t want to log AC loss errors at standby, but we do want to maintain/provide accurate status at all times (Brandon has confirmed we do monitor the psu at standby).  \n\nBrandon shouldn\u0027t this clearBrownout() be done when we see the psu input voltage come back into range (in analyze())?",
      "parentUuid": "223ce409_729fb9de",
      "revId": "84c5a99167902dc541bea2de90dfc6cb3937525e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "70e843a5_553daecd",
        "filename": "phosphor-power-supply/psu_manager.cpp",
        "patchSetId": 6
      },
      "lineNbr": 364,
      "author": {
        "id": 1000318
      },
      "writtenOn": "2022-03-24T18:21:02Z",
      "side": 1,
      "message": "Or maybe the call in PSUManager::analyze() handles when it\u0027s detected to have came back in PowerSupply::analyze()?",
      "parentUuid": "e78d171a_2b08d6b1",
      "revId": "84c5a99167902dc541bea2de90dfc6cb3937525e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "32a52f14_ce934a52",
        "filename": "phosphor-power-supply/psu_manager.cpp",
        "patchSetId": 6
      },
      "lineNbr": 364,
      "author": {
        "id": 1000003
      },
      "writtenOn": "2022-03-24T18:30:29Z",
      "side": 1,
      "message": "The conversation above makes sense. Will remove this clearBrownout() from the power off path. Then change the following logic in PSUManager::analyze() from:\n\nPSUManager::analyze() \n{\n    PowerSupply::analyze()\n    if (powerOn)\n    {\n        if Brownout: setBrownout()\n        else: clearBrownout()\n\n        analyze faults\n    }\n}\n\nto:\n\nPSUManager::analyze() \n{\n    PowerSupply::analyze()\n    if Brownout: if powerOn: setBrownout()\n    else: clearBrownout()\n\n    if (powerOn)\n    {\n        analyze faults\n    }\n}",
      "parentUuid": "70e843a5_553daecd",
      "revId": "84c5a99167902dc541bea2de90dfc6cb3937525e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a3e1c28c_be3391aa",
        "filename": "phosphor-power-supply/psu_manager.cpp",
        "patchSetId": 6
      },
      "lineNbr": 364,
      "author": {
        "id": 1000331
      },
      "writtenOn": "2022-03-24T18:56:03Z",
      "side": 1,
      "message": "If a brownout is occurring, and the power is off, we\u0027d still want to update the D-Bus interface right?  Based on Derek\u0027s comment, maybe we wouldn\u0027t log the error though if power is off (not sure on this part).\n\nIf so maybe it is\n  if Brownout: setBrownout()\n  else: clearBrownout()\n\nand in setBrownout, it always sets the interface property but only logs an error if the power is on?",
      "parentUuid": "32a52f14_ce934a52",
      "revId": "84c5a99167902dc541bea2de90dfc6cb3937525e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}